::id from-portage-to-paludis
::title Migration from portage to paludis
::date 2014-08-03T21:09:05.802Z
So, I've recently decided to move my gentoo installation from good old portage to paludis after reading a few threads [on the gentoo forums](https://forums.gentoo.org/index.php) made me curious about it.
For example, there was some talk about paludis being slower than portage because it is more accurate in its dependency calculation and I couldn't really imagine what that would mean, as portage seemed pretty accurate to me.

The installation is as easy as it could get, just emerge _sys-apps/paludis_. You need to do some configuration to get started, [paludis.exherbo.org](http://paludis.exherbo.org) has [a nice page](http://paludis.exherbo.org/overview/gettingstarted.html) for that. The **Using an existing Portage configuration** talks about a _portage_ USE-flag that doesn't seem to exist, so I used the **Automatically migrating** method with the help of the [portage2paludis](http://git.exherbo.org/paludis/paludis-scripts.git/plain/portage2paludis.bash) script.
This does a decent job at setting up most of the files inside /etc/paludis, although it failed at migrating the package.accept\\\_keywords file (maybe it would have worked if I would use a folder instead of a file). Fixing that manually wasn't really a problem, a quick _cat /usr/portage/package.accept_keywords >> /etc/paludis/keywords.conf_ followed by replacing all _~amd64_ with _amd64 ~amd64_ worked fine.

I mainly use clang as a compiler instead of gcc so I had to configure paludis accordingly. Setting the correct CC and CXX in the bashrc works fine for most packages but there are some (e.g. glibc) that simply won't compile. This can be pretty easily configured with portage by using [/etc/portage/env](http://wiki.gentoo.org/wiki//etc/portage/env) but I haven't found an easy way to do this with paludis. The [getting started page](http://paludis.exherbo.org/overview/gettingstarted.html) describes a way to set package specific settings inside the bashrc that I used to hack a little script so I can continue to use a simple package list instead of writing a lot of if clauses inside the bashrc. You can view my [bashrc](https://gist.github.com/beji/1badd4e94d269d4294f2), my [package list](https://gist.github.com/beji/dd9b5d068f4f6e23fbb7) and my [node script to parse the list](https://gist.github.com/beji/3ddfe10a88114023cb6f) on [gist.github.com](https://gist.github.com/beji). This can probably be done in an easier way and without requiring node.js but it works fine for now, although this doesn't handle version-specific settings, it only works on the whole package.

So far, so good. The real problems started to happen when I first tried to _cave resolve --complete world_ to see if paludis actually does something and it basically ran into a wall. After some research I gathered the following problems:

1. **paludis doesn't handle multiple _RUBY_TARGET_ values at all.** This was somewhat easily fixed by just using _ruby20_ and a simple emerge && emerge --depclean
1. **paludis is very strict at handling package requirements.** I had a few packages insisting on _virtual/udev_ having the _gudev_ flag set, which I would be more than happy to do, except for the fact that the virtual doesn't have that flag. I could track that down to an issue with _gnome-base/gvfs_ and _sys-fs/udisks_ and I simply chose to get rid of them by removing thunar and wine and removing the udev flag from _media-gfx/gimp_. After that I removed the udisks USE-flag I had globally set and simply installed thunar again with cave and everything went fine.
1. **paludis checks if there are actual packages fitting to what you have installed.** If you have something like _=app-admin/pass-1.6.3 ~amd64_ defined inside your package.accept_keywords and that specific package version gets removed from the repo, portage simply doesn't tell you. Sure, you can get this information from _eix-test-obsolete_ or by carefully reading what _eix-sync_ prints out but I apparently missed the info and I rarely use eix-test-obsolete so I didn't notice that until paludis gave me a hint.

Overall, paludis works fine now and I'm interested to see how it will work out in the long run
